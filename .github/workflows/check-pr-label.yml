name: Check PR Label

on:
    workflow_call:
        inputs:
            labels:
                required: true
                type: string
                description: "JSON string of labels from the pull request"
                default: ${{ toJSON(github.event.pull_request.labels) }}
            target_label:
                required: true
                type: string
                description: "Target label to check for in the PR"
        outputs:
            has_label:
                value: ${{ jobs.check-label.outputs.has_label }}

jobs:
    check-label:
        name: check-label
        runs-on: ubuntu-latest
        outputs:
            has_label: ${{ steps.check.outputs.has_label }}
        steps:
            - name: Check for label
              id: check
              run: |
                  TARGET_LABEL="${{ inputs.target_label }}"
                  echo "Checking for label: $TARGET_LABEL"
                  echo "Input labels: ${{ inputs.labels }}"

                  # Use jq to check if the label exists in the labels array
                  HAS_LABEL=$(echo '${{ inputs.labels }}' | \
                    jq --arg target "$TARGET_LABEL" \
                    '[.[] | select(.name == $target)] | length > 0')

                  echo "Has label: $HAS_LABEL"

                  if [ "$HAS_LABEL" = "true" ]; then
                    echo "has_label=true" >> $GITHUB_OUTPUT
                    echo "✅ Label '$TARGET_LABEL' found"
                  else
                    echo "has_label=false" >> $GITHUB_OUTPUT
                    echo "❌ Label '$TARGET_LABEL' not found"
                  fi
