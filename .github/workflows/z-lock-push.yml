name: z-lock-push

on:
    push:

permissions:
    contents: write

jobs:
    # key owner = github.sha
    debug:
        runs-on: ubuntu-latest
        steps:
            - name: Debug Push Context
              run: |
                  echo "=== Push Trigger Debug Info ==="
                  echo "github.ref: ${{ github.ref }}"
                  echo "github.ref_name: ${{ github.ref_name }}"
                  echo "github.event.number: ${{ github.event.number }}"
                  echo "github.event_name: ${{ github.event_name }}"
                  echo "github.sha: ${{ github.sha }}"
                  echo "github.run_id: ${{ github.run_id }}"
                  echo "github.actor: ${{ github.actor }}"

    lock:
        uses: ./.github/workflows/z-reusable-lock.yml
        with:
            key: "d"
            key_owner: ${{ github.ref }}-${{ github.sha }}

    unlock:
        needs: lock
        uses: ./.github/workflows/z-reusable-unlock.yml
        with:
            key: "d"
            key_owner: ${{ github.ref }}-${{ github.sha }}
